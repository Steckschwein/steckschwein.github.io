<!doctype html><html lang=en><head><title>SPI-Devices ::</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &amp;ldquo;killer application&amp;rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&amp;rsquo;s open collector outputs pulled up to 3."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://beta.steckschwein.de/spi-devices/><link rel=stylesheet href=https://beta.steckschwein.de/assets/style.css><link rel=stylesheet href=https://beta.steckschwein.de/assets/green.css><link rel=apple-touch-icon href=https://beta.steckschwein.de/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://beta.steckschwein.de/img/favicon/green.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="SPI-Devices"><meta property="og:description" content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &amp;ldquo;killer application&amp;rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&amp;rsquo;s open collector outputs pulled up to 3."><meta property="og:url" content="https://beta.steckschwein.de/spi-devices/"><meta property="og:site_name" content><meta property="og:image" content="https://beta.steckschwein.de/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2015-09-15 00:00:00 +0000 UTC"></head><body class=green><div class="container headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Steckschwein</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/>The Project</a></li><li><a href=/hardware/>Hardware</a></li><li><a href=/software/>Software</a></li><li><a href=/impressum/>Impressum</a></li><li><a href=/post/>Posts</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/>The Project</a></li><li><a href=/hardware/>Hardware</a></li><li><a href=/software/>Software</a></li><li><a href=/impressum/>Impressum</a></li><li><a href=/post/>Posts</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://beta.steckschwein.de/spi-devices/>SPI-Devices</a></h1><div class=post-meta><span class=post-date>2015-09-15</span></div><div class=post-content><div><h3 id=sd-card-as-really-cheap-and-lazy-mass-storage>SD-Card as really cheap and lazy mass storage<a href=#sd-card-as-really-cheap-and-lazy-mass-storage class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3.3V. The other direction, MISO, is routed to one of the units of a 74HCT125, whose inputs can deal with 3.3V logic and whose outputs are TTL compliant, hence HCT.</p><p>With mass storage implemented as simple as that, why bother fiddling around with floppy disk controllers or IDE drives or stuff like that?</p><p><img src=images/io_sdcard.png alt=io_sdcard></p><h4 id=atmega8-used-as-ps2-keyboard-controller>ATmega8 used as PS/2 keyboard controller<a href=#atmega8-used-as-ps2-keyboard-controller class=hanchor arialabel=Anchor>&#8983;</a></h4><p>An ATmega8 is used as PS/2 keyboard and maybe (later) mouse controller. The code running on the ATmega is based on <a href=http://www.atmel.com/Images/doc1235.pdf>AVR Application Note 313</a> , but without the UART code. Instead, we added code to act as an SPI slave. Also, we implemented a german keyboard layout and support for a few modifier keys that was missing in the original code. Also, special keys or key combinations like SysRq and the three-finger-salute are being handled directly by the keyboard controller to pull the respective signals like NMI or trigger a hardware reset.</p><p><img src=images/io_kbdctrl.png alt=io_kbdctrl></p><p><strong>RTC DS1306</strong></p><p>The RTC DS1306 delivers the current time down to second resolution, supports two alarms and also has 96 bytes of battery backed memory, which makes it double as storage for system boot parameters. In fact, we store the name of the file to load at boot time and also the UART parameters there. Main reason to add the RTC was, that a real nice machine of course needs an RTC, but also as a time source to set the proper file creation time and date in our FAT32 implementation.</p><p><img src=images/io_rtc.png alt=io_rtc></p></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://beta.steckschwein.de/assets/main.js></script>
<script src=https://beta.steckschwein.de/assets/prism.js></script></div></body></html>