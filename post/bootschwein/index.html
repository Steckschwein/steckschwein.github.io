<!doctype html><html lang=en><head><title>Bootschwein :: Steckschwein</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Die Aufgabe, die wir dem (Steck)BIOS zugedacht haben, beschränkt sich darauf, die vorhandene Hardware zu initialisieren, auf eine eingelegte SD-Karte zu prüfen, und dann von dort das eigentliche &amp;ldquo;Betriebssystem&amp;rdquo; zu laden. Fast ein bisschen PC-like.
Hier ist die Überlegung, im Stammverzeichnis eine bestimmte Datei zu finden und an eine bestimmte Adresse in den Speicher zu laden.
Sollte dies fehlschlagen, kann man immer noch in einen Monitor oder unsere bekannte rs232-Uploadroutine springen."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://www.steckschwein.de/post/bootschwein/><link rel=stylesheet href=https://www.steckschwein.de/assets/style.css><link rel=stylesheet href=https://www.steckschwein.de/assets/green.css><link rel=apple-touch-icon href=https://www.steckschwein.de/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://www.steckschwein.de/img/favicon/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Bootschwein"><meta property="og:description" content="Die Aufgabe, die wir dem (Steck)BIOS zugedacht haben, beschränkt sich darauf, die vorhandene Hardware zu initialisieren, auf eine eingelegte SD-Karte zu prüfen, und dann von dort das eigentliche &amp;ldquo;Betriebssystem&amp;rdquo; zu laden. Fast ein bisschen PC-like.
Hier ist die Überlegung, im Stammverzeichnis eine bestimmte Datei zu finden und an eine bestimmte Adresse in den Speicher zu laden.
Sollte dies fehlschlagen, kann man immer noch in einen Monitor oder unsere bekannte rs232-Uploadroutine springen."><meta property="og:url" content="https://www.steckschwein.de/post/bootschwein/"><meta property="og:site_name" content="Steckschwein"><meta property="og:image" content="https://www.steckschwein.de/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="bios"><meta property="article:section" content="bootloader"><meta property="article:section" content="fat"><meta property="article:section" content="fat32"><meta property="article:section" content="sd-karte"><meta property="article:published_time" content="2015-01-05 00:00:00 +0000 UTC"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Steckschwein</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about/>About</a></li><li><a href=/hardware/>Hardware</a></li><li><a href=/software/>Software</a></li><li><a href=/impressum/>Impressum</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about/>About</a></li><li><a href=/hardware/>Hardware</a></li><li><a href=/software/>Software</a></li><li><a href=/impressum/>Impressum</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://www.steckschwein.de/post/bootschwein/>Bootschwein</a></h1><div class=post-meta><span class=post-date>2015-01-05</span></div><div class=post-content><div><p>Die Aufgabe, die wir dem (Steck)BIOS zugedacht haben, beschränkt sich darauf, die vorhandene Hardware zu initialisieren, auf eine eingelegte SD-Karte zu prüfen, und dann von dort das eigentliche &ldquo;Betriebssystem&rdquo; zu laden. Fast ein bisschen PC-like.</p><p>Hier ist die Überlegung, im Stammverzeichnis eine bestimmte Datei zu finden und an eine bestimmte Adresse in den Speicher zu laden.</p><p>Sollte dies fehlschlagen, kann man immer noch in einen Monitor oder unsere bekannte rs232-Uploadroutine springen.</p><p>Um nun also eine Datei auf der SD-Karte zu finden, müssen wir erstmal rudimentäre Unterstützung für das FAT-Dateisystem bauen. FAT stammt aus den 70er Jahren und hat als Dateisystem für MS-DOS-basierte Betriebssysteme Verbreitung gefunden. Ursprünglich war es für Disketten gedacht (FAT12), und wurde immer wieder erweitert, um auch wesentlich größere Datenträgerkapazitäten wie z.B. von Festplatten zunächst bis 2GB (FAT16), dann aber auch über diese Begrenzung heraus (FAT32) zu unterstützen.</p><p>Da so ziemlich jede SD-Karte, die man heute kaufen kann, mindestens 2GB Kapazität hat, lassen wir FAT12 und FAT16 außen vor, und konzentrieren uns nur auf FAT32. Hierzu ist sicherlich die <a href=http://msdn.microsoft.com/en-us/windows/hardware/gg463080.aspx>offizielle Dokumentation von Microsoft</a> eine sinnvolle Lektüre, als wesentlich hilfreicher hat sich aber das auf FAT32 konzentrierte <a href=https://www.pjrc.com/tech/8051/ide/fat32.html>Understanding FAT32 Filesystems von Paul Stoffregen</a> erwiesen, indem es einen gezielt durch die Strukturen führt, die man für FAT32 tatsächlich braucht.</p><p>Unsere Implementation beschränkt sich darauf, das Stammverzeichnis der ersten Partition zu lesen, bis eine Datei gefunden wird, die das &ldquo;System&rdquo;-Attribut hat. Diese wird eingelesen.</p><p>Hierbei ist das Verfolgen der Clusterketten, also das eigentliche Auswerten der FAT, nicht implementiert, sodass die max. Dateigröße der Größe eines Clusters entspricht. Zum finden und laden dessen, was später mal unser &ldquo;Betriebsystem&rdquo; werden soll, reicht es aber.</p><p>Der rudimentäre Code findet sich in unserem <a href=https://sourceforge.net/p/steckschwein/code/ci/default/tree/fat/>Repository auf Sourceforge</a>.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://www.steckschwein.de/post/genug/><span class=button__icon>←</span>
<span class=button__text>Genug</span></a></span>
<span class="button next"><a href=https://www.steckschwein.de/post/das-schwein-kann-singen/><span class=button__text>Das Schwein kann singen...</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://www.steckschwein.de/assets/main.js></script>
<script src=https://www.steckschwein.de/assets/prism.js></script></div></body></html>