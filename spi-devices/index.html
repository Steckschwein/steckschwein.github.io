<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>SPI-Devices | My New Hugo Site</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3."><meta name=generator content="Hugo 0.101.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="SPI-Devices"><meta property="og:description" content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3."><meta property="og:type" content="article"><meta property="og:url" content="https://steckschwein.github.io/spi-devices/"><meta property="article:section" content><meta property="article:published_time" content="2015-09-15T00:00:00+00:00"><meta property="article:modified_time" content="2015-09-15T00:00:00+00:00"><meta itemprop=name content="SPI-Devices"><meta itemprop=description content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3."><meta itemprop=datePublished content="2015-09-15T00:00:00+00:00"><meta itemprop=dateModified content="2015-09-15T00:00:00+00:00"><meta itemprop=wordCount content="328"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="SPI-Devices"><meta name=twitter:description content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">My New Hugo Site</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/home/ title="The Project page">The Project</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/hardware/ title="Hardware page">Hardware</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/software/ title="Software page">Software</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/impressum/ title="Impressum page">Impressum</a></li></ul><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><div class="flex-l mt2 mw8 center"><article class="center cf pv5 ph3 ph4-ns mw7"><header><h1 class=f1>SPI-Devices</h1></header><div class="nested-copy-line-height lh-copy f4 nested-links mid-gray"><h3 id=sd-card-as-really-cheap-and-lazy-mass-storage>SD-Card as really cheap and lazy mass storage</h3><p>Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3.3V. The other direction, MISO, is routed to one of the units of a 74HCT125, whose inputs can deal with 3.3V logic and whose outputs are TTL compliant, hence HCT.</p><p>With mass storage implemented as simple as that, why bother fiddling around with floppy disk controllers or IDE drives or stuff like that?</p><p><img src=images/io_sdcard.png alt=io_sdcard></p><h4 id=atmega8-used-as-ps2-keyboard-controller>ATmega8 used as PS/2 keyboard controller</h4><p>An ATmega8 is used as PS/2 keyboard and maybe (later) mouse controller. The code running on the ATmega is based on <a href=http://www.atmel.com/Images/doc1235.pdf>AVR Application Note 313</a> , but without the UART code. Instead, we added code to act as an SPI slave. Also, we implemented a german keyboard layout and support for a few modifier keys that was missing in the original code. Also, special keys or key combinations like SysRq and the three-finger-salute are being handled directly by the keyboard controller to pull the respective signals like NMI or trigger a hardware reset.</p><p><img src=images/io_kbdctrl.png alt=io_kbdctrl></p><p><strong>RTC DS1306</strong></p><p>The RTC DS1306 delivers the current time down to second resolution, supports two alarms and also has 96 bytes of battery backed memory, which makes it double as storage for system boot parameters. In fact, we store the name of the file to load at boot time and also the UART parameters there. Main reason to add the RTC was, that a real nice machine of course needs an RTC, but also as a time source to set the proper file creation time and date in our FAT32 implementation.</p><p><img src=images/io_rtc.png alt=io_rtc></p></div></article></div></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://steckschwein.github.io/>&copy; My New Hugo Site 2022</a><div><div class=ananke-socials></div></div></div></footer></body></html>