<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>IO: VIA 65c22 as SPI-Master | My New Hugo Site</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="One of the fundamental design decisions when creating the Steckschwein was to use SPI as the main peripheral bus. This way, various different devices can be utilized using a single interface protocol. The main killer feature for using SPI was to be able to use an SD card as mass storage. This gives us mass storage with almost no extra hardware effort, only level conversion is needed between the system (5V) and the card (3."><meta name=generator content="Hugo 0.101.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="IO: VIA 65c22 as SPI-Master"><meta property="og:description" content="One of the fundamental design decisions when creating the Steckschwein was to use SPI as the main peripheral bus. This way, various different devices can be utilized using a single interface protocol. The main killer feature for using SPI was to be able to use an SD card as mass storage. This gives us mass storage with almost no extra hardware effort, only level conversion is needed between the system (5V) and the card (3."><meta property="og:type" content="article"><meta property="og:url" content="https://steckschwein.github.io/via-65c22-as-spi-master/"><meta property="article:section" content><meta property="article:published_time" content="2015-09-15T00:00:00+00:00"><meta property="article:modified_time" content="2015-09-15T00:00:00+00:00"><meta itemprop=name content="IO: VIA 65c22 as SPI-Master"><meta itemprop=description content="One of the fundamental design decisions when creating the Steckschwein was to use SPI as the main peripheral bus. This way, various different devices can be utilized using a single interface protocol. The main killer feature for using SPI was to be able to use an SD card as mass storage. This gives us mass storage with almost no extra hardware effort, only level conversion is needed between the system (5V) and the card (3."><meta itemprop=datePublished content="2015-09-15T00:00:00+00:00"><meta itemprop=dateModified content="2015-09-15T00:00:00+00:00"><meta itemprop=wordCount content="275"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="IO: VIA 65c22 as SPI-Master"><meta name=twitter:description content="One of the fundamental design decisions when creating the Steckschwein was to use SPI as the main peripheral bus. This way, various different devices can be utilized using a single interface protocol. The main killer feature for using SPI was to be able to use an SD card as mass storage. This gives us mass storage with almost no extra hardware effort, only level conversion is needed between the system (5V) and the card (3."></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">My New Hugo Site</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/home/ title="The Project page">The Project</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/hardware/ title="Hardware page">Hardware</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/software/ title="Software page">Software</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/impressum/ title="Impressum page">Impressum</a></li></ul><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><div class="flex-l mt2 mw8 center"><article class="center cf pv5 ph3 ph4-ns mw7"><header><h1 class=f1>IO: VIA 65c22 as SPI-Master</h1></header><div class="nested-copy-line-height lh-copy f4 nested-links mid-gray"><p>One of the fundamental design decisions when creating the Steckschwein was to use SPI as the main peripheral bus. This way, various different devices can be utilized using a single interface protocol. The main killer feature for using SPI was to be able to use an SD card as mass storage. This gives us mass storage with almost no extra hardware effort, only level conversion is needed between the system (5V) and the card (3.3V).</p><p>The most common io device for the 6502 processor is the 6522 VIA (Versatile Interface Adapter). In our case, we are using it among a few other things as as the SPI master. VIA port B is solely dedicated to be used with SPI devices. The direction MISO (Master In, Slave Out) is covered by the internal shift register of the VIA. The VIA pins are used as follows:</p><p>Basically, the process of reading data via SPI only consists of setting the appropriate slave select pin to low and then &ldquo;wiggling&rdquo; the PB0 pin as fast as possible, which is determined by how fast the CPU is able to write to the port. This also means that the shift register is used in &ldquo;Shift In - External CB1 Clock Control (011)"-mode, which is the very mode affected by the infamous <a href="http://forum.6502.org/viewtopic.php?t=342#p2310">VIA-Bug</a>. We did not do anything circuit wise to implement a workaround. We rather rely on the fact, that we create the SPI clock using the processor and hereby have the SPI clock locked to the system clock, so the signal slopes have a fixed delay. This should take care of the bug not to occur. Hopefully.</p><p><img src=images/io_via.png alt=io_via></p><p><a href=https://steckschwein.files.wordpress.com/2018/03/io.pdf title=io>Schematic as PDF</a></p></div></article></div></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://steckschwein.github.io/>&copy; My New Hugo Site 2022</a><div><div class=ananke-socials></div></div></div></footer></body></html>