<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.ico><title>SPI-Devices - Steckschwein</title><meta name=description content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3."><meta name=generator content="Hugo 0.101.0"><link rel=stylesheet href=https://steckschwein.github.io/css/main.css><meta property="og:title" content="SPI-Devices"><meta property="og:description" content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3."><meta property="og:type" content="article"><meta property="og:url" content="https://steckschwein.github.io/spi-devices/"><meta property="article:section" content><meta property="article:published_time" content="2015-09-15T00:00:00+00:00"><meta property="article:modified_time" content="2015-09-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="SPI-Devices"><meta name=twitter:description content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3."><meta itemprop=name content="SPI-Devices"><meta itemprop=description content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3."><meta itemprop=datePublished content="2015-09-15T00:00:00+00:00"><meta itemprop=dateModified content="2015-09-15T00:00:00+00:00"><meta itemprop=wordCount content="328"><meta itemprop=keywords content><meta itemprop=name content="SPI-Devices"><meta itemprop=description content="SD-Card as really cheap and lazy mass storage Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3."><meta itemprop=datePublished content="2015-09-15T00:00:00+00:00"><meta itemprop=dateModified content="2015-09-15T00:00:00+00:00"><meta itemprop=wordCount content="328"><meta itemprop=keywords content></head><body class="flex relative h-full min-h-screen"><aside class="will-change-transform transform transition-transform -translate-x-full absolute top-0 left-0 md:relative md:translate-x-0 w-3/4 md:w-60 h-full min-h-screen p-3 bg-slate-50 dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex flex-col gap-2.5 z-20 sidebar"><p class="font-bold mb-5 flex items-center gap-2"><button aria-label="Close sidebar" class="md:hidden menu-trigger-close p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-6 w-6" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
<a href=https://steckschwein.github.io class=px-2><span>Steckschwein</span></a>
<button aria-label="Toggle dark mode" class="dark-mode-toggle p-2 rounded border dark:border-slate-700 hover:bg-slate-200 dark:hover:bg-slate-700"><svg class="h-4 w-4" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="4"/><path d="M3 12h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7M6.3 17.7l-.7.7"/></svg></button></p><ul class="list-none flex flex-col gap-1"><li><a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between hover:bg-slate-200 dark:hover:bg-slate-700" href=/home/><span>The Project</span></a></li><li><a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between hover:bg-slate-200 dark:hover:bg-slate-700" href=/hardware/><span>Hardware</span></a></li><li><a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between hover:bg-slate-200 dark:hover:bg-slate-700" href=/software/><span>Software</span></a></li><li><a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between hover:bg-slate-200 dark:hover:bg-slate-700" href=/impressum/><span>Impressum</span></a></li><li><a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between hover:bg-slate-200 dark:hover:bg-slate-700" href=/articles/><span>Articles</span></a></li><li><a class="px-2 py-1.5 rounded-md text-sm flex items-center justify-between hover:bg-slate-200 dark:hover:bg-slate-700" href=/post/><span>Posts</span></a></li></ul><div class=flex-1></div><ul class="list-none flex flex-wrap justify-center gap-1 pt-2 border-t border-slate-200 dark:border-slate-600"></ul></aside><div class="fixed bg-slate-700 bg-opacity-5 transition duration-200 ease-in-out inset-0 z-10 pointer-events-auto md:hidden left-0 top-0 w-full h-full hidden menu-overlay"></div><button aria-label="Toggle Sidebar" class="md:hidden absolute top-3 left-3 z-10 menu-trigger p-1 rounded text-slate-800 dark:text-slate-50 hover:bg-slate-100"><svg class="h-6 w-6" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="16" y2="18"/></svg></button><div class=flex-1><main class="h-screen overflow-y-auto"><div class="px-6 py-20 w-full lg:w-[580px] mx-auto prose dark:prose-invert h-fit prose-img:mx-auto"><h1>SPI-Devices</h1><p class="text-sm text-slate-500 !mb-8">September 15, 2015</p><h3 id=sd-card-as-really-cheap-and-lazy-mass-storage>SD-Card as really cheap and lazy mass storage</h3><p>Most important device on the Steckschwein using the SPI-Bus and therefore the &ldquo;killer application&rdquo;, that sold the idea of using SPI to us, is the sd card. The only additional hardware effort was to level shift the signals from and to the sd-card, as it runs on 3.3V while the Steckschwein uses 5V. To accomplish this, the SPI clock, SPI slave select and MOSI are converted using a 74LS07, with it&rsquo;s open collector outputs pulled up to 3.3V. The other direction, MISO, is routed to one of the units of a 74HCT125, whose inputs can deal with 3.3V logic and whose outputs are TTL compliant, hence HCT.</p><p>With mass storage implemented as simple as that, why bother fiddling around with floppy disk controllers or IDE drives or stuff like that?</p><p><img src=images/io_sdcard.png alt=io_sdcard></p><h4 id=atmega8-used-as-ps2-keyboard-controller>ATmega8 used as PS/2 keyboard controller</h4><p>An ATmega8 is used as PS/2 keyboard and maybe (later) mouse controller. The code running on the ATmega is based on <a href=http://www.atmel.com/Images/doc1235.pdf target=_blank rel=noopener>AVR Application Note 313</a> , but without the UART code. Instead, we added code to act as an SPI slave. Also, we implemented a german keyboard layout and support for a few modifier keys that was missing in the original code. Also, special keys or key combinations like SysRq and the three-finger-salute are being handled directly by the keyboard controller to pull the respective signals like NMI or trigger a hardware reset.</p><p><img src=images/io_kbdctrl.png alt=io_kbdctrl></p><p><strong>RTC DS1306</strong></p><p>The RTC DS1306 delivers the current time down to second resolution, supports two alarms and also has 96 bytes of battery backed memory, which makes it double as storage for system boot parameters. In fact, we store the name of the file to load at boot time and also the UART parameters there. Main reason to add the RTC was, that a real nice machine of course needs an RTC, but also as a time source to set the proper file creation time and date in our FAT32 implementation.</p><p><img src=images/io_rtc.png alt=io_rtc></p></div></main></div><script type=text/javascript src=/main.js defer></script></body></html>